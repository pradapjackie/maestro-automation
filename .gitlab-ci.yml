stages:
  - test
  - report

before_script:
  - apt-get update -y
  - apt-get install -y curl unzip tar android-sdk
  # Download OpenJDK 11 from Adoptium's official site
  - curl -L https://github.com/adoptium/temurin11-binaries/releases/download/jdk-11.0.17+8/OpenJDK11U-jdk_x64_linux_hotspot_11.0.17_8.tar.gz -o openjdk-11.tar.gz
  # Verify the file type
  - file openjdk-11.tar.gz
  # Extract OpenJDK 11 if the file is valid
  - tar -xzvf openjdk-11.tar.gz
  - export PATH=$PATH:$CI_PROJECT_DIR/jdk-11/bin
  # Verify the installation
  - java -version


# Job to run Maestro tests
maestro_test:
  stage: test
  script:
    - adb install sample.apk
    - maestro test android.yaml --format junit --output results.xml
  artifacts:
    paths:
      - results.xml

# Job to generate Allure report
allure_report:
  stage: report
  image: "alpine:latest"
  script:
    - apk add --no-cache allure
    - mkdir -p allure-results
    - mv results.xml allure-results/
    - allure serve allure-results
  dependencies:
    - maestro_test
  artifacts:
    paths:
      - allure-results
  only:
    - main  # or your desired branch
